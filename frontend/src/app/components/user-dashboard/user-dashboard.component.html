<header>
Â  <h1>Panel de Usuario</h1>
Â  <p *ngIf="user$ | async as user">Bienvenido, {{ user.full_name }}</p>
Â  <button (click)="logout()">Cerrar sesiÃ³n</button>
</header>

<section>
Â  <h2>Locales disponibles</h2>

  <!-- Selector de Fecha Global para la consulta -->
  <div class="search-controls">
    <label for="date-select">Consultar Disponibilidad en Fecha:</label>
    <!-- [(ngModel)] enlaza searchDate en el TS -->
    <input type="date" id="date-select" [(ngModel)]="searchDate">
  </div>
  
Â  <div *ngFor="let l of locales" class="locale-card">
Â  Â  <h3>{{ l.name }}</h3>
Â  Â  <p>{{ l.description }}</p>
Â  Â  <p>Capacidad: {{ l.capacity }}</p>
    
    <!-- 1. BOTÃ“N PARA ACTIVAR LA CONSULTA -->
    <button (click)="checkAvailability(l.id)">
        Ver Horarios Libres para {{ searchDate }}
    </button>

    <!-- 2. PANEL DE DISPONIBILIDAD (Solo visible si es el local seleccionado) -->
    <div *ngIf="selectedLocaleId === l.id" class="availability-panel">
        <hr>
        <h4>Disponibilidad:</h4>
        
        <div *ngIf="loadingAvailability">Cargando horarios...</div>
        
        <div *ngIf="availability && !loadingAvailability">
            
            <p *ngIf="availability.available_slots.length === 0">ðŸš« No hay horarios libres este dÃ­a.</p>
            
            <!-- LISTA DE SLOTS DISPONIBLES -->
            <ul class="slot-list">
                <li *ngFor="let slot of availability.available_slots"
                    [class.selected-slot]="selectedSlot && selectedSlot.start_dt === slot.start_dt"
                    (click)="selectedSlot = slot"
                >
                    {{ slot.start_dt | date:'shortTime' }} - {{ slot.end_dt | date:'shortTime' }}
                </li>
            </ul>

            <!-- 3. FORMULARIO DE RESERVA FINAL (Solo visible si hay un slot seleccionado) -->
            <div *ngIf="selectedSlot" class="reservation-form">
                <h5>Confirmar Reserva:</h5>
                <p class="selected-time">De: {{ selectedSlot.start_dt | date:'shortTime' }} a {{ selectedSlot.end_dt | date:'shortTime' }}</p>

                <label>
                    Motivo:
                    <!-- [(ngModel)] enlaza motiveInput en el TS -->
                    <textarea [(ngModel)]="motiveInput" placeholder="Describe brevemente el motivo de la reserva..."></textarea>
                </label>
                
                <!-- 4. BOTÃ“N DE SOLICITUD (llama a la funciÃ³n con los datos del slot) -->
                <button (click)="onReserve(l.id)">
                    Solicitar Reserva
                </button>
                <button (click)="selectedSlot = null">Cancelar SelecciÃ³n</button>
            </div>
        </div>
        <!-- Mostrar slots ocupados para contexto (opcional) -->
        <details>
            <summary>Horarios Ocupados ({{ availability?.occupied_slots?.length || 0 }})</summary>
            <ul class="occupied-list">
                <li *ngFor="let slot of availability?.occupied_slots">
                    {{ slot.start_dt | date:'shortTime' }} - {{ slot.end_dt | date:'shortTime' }}
                </li>
            </ul>
        </details>
    </div>
Â  </div>
</section>
<section>
Â  <h2>Mis reservas</h2>
Â  <div *ngFor="let r of reservations" class="reservation-card">
Â  Â  <p><strong>ID:</strong> {{ r.id }}</p>
Â  Â  <p><strong>Inicio:</strong> {{ r.start_dt | date:'short' }}</p>
Â  Â  <p><strong>Fin:</strong> {{ r.end_dt | date:'short' }}</p>
Â  Â  <p><strong>Estado:</strong> {{ r.status }}</p>
Â  </div>
</section>
